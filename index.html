<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML File Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .upload-area.dragover {
            border-color: #5D5CDE;
            background-color: rgba(93, 92, 222, 0.1);
        }
        .dark .upload-area {
            border-color: #4b5563;
        }
        .dark .upload-area.dragover {
            border-color: #5D5CDE;
            background-color: rgba(93, 92, 222, 0.1);
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
    <!-- Home Page -->
    <div id="homePage" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-6">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">HTML File Viewer</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Upload and preview HTML files in your browser</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <!-- Upload Area -->
                <div id="uploadArea" class="upload-area rounded-lg p-8 text-center cursor-pointer">
                    <div class="space-y-4">
                        <svg class="mx-auto h-16 w-16 text-gray-400 dark:text-gray-500" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Upload HTML File</h3>
                            <p class="text-gray-500 dark:text-gray-400">Click to browse or drag and drop your HTML file here</p>
                        </div>
                        <div class="text-sm text-gray-400 dark:text-gray-500">
                            Supported formats: .html, .htm
                        </div>
                    </div>
                </div>

                <!-- File Input (Hidden) -->
                <input type="file" id="fileInput" accept=".html,.htm" class="hidden">

                <!-- Error Message -->
                <div id="errorMessage" class="hidden mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                    <p class="text-red-600 dark:text-red-400 text-sm"></p>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="hidden mt-6 text-center">
                    <div class="inline-flex items-center space-x-2">
                        <svg class="animate-spin h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-gray-600 dark:text-gray-400">Loading HTML file...</span>
                    </div>
                </div>

                <!-- Recent Files -->
                <div id="recentFiles" class="mt-8 hidden">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Recent Files</h2>
                    <div id="recentFilesList" class="space-y-2"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Preview Page -->
    <div id="previewPage" class="hidden fixed inset-0 bg-white dark:bg-gray-900">
        <!-- Preview Header -->
        <div class="absolute top-0 left-0 right-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 z-10">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button id="backButton" class="inline-flex items-center space-x-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        <span>Back to Home</span>
                    </button>
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        <span id="fileName"></span>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="refreshButton" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Preview Content -->
        <div class="pt-16 h-full">
            <iframe id="previewFrame" class="w-full h-full border-0" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Elements
        const homePage = document.getElementById('homePage');
        const previewPage = document.getElementById('previewPage');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const errorMessage = document.getElementById('errorMessage');
        const loadingState = document.getElementById('loadingState');
        const backButton = document.getElementById('backButton');
        const refreshButton = document.getElementById('refreshButton');
        const fileName = document.getElementById('fileName');
        const previewFrame = document.getElementById('previewFrame');
        const recentFiles = document.getElementById('recentFiles');
        const recentFilesList = document.getElementById('recentFilesList');

        // State
        let currentFileContent = '';
        let currentFileName = '';
        let recentFileNames = [];

        // Initialize
        function init() {
            setupEventListeners();
            loadRecentFiles();
            
            // Handle initial page load and browser navigation
            window.addEventListener('popstate', (event) => {
                if (event.state && event.state.page === 'preview') {
                    // If we're supposed to be on preview but no file loaded, go home
                    if (!currentFileContent) {
                        showHomePage();
                        history.replaceState({ page: 'home' }, '', window.location.pathname);
                    }
                } else {
                    showHomePage();
                }
            });

            // Set initial state
            history.replaceState({ page: 'home' }, '', window.location.pathname);
        }

        function setupEventListeners() {
            // Upload area click
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            // File input change
            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);

            // Navigation buttons
            backButton.addEventListener('click', goHome);
            refreshButton.addEventListener('click', refreshPreview);
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function processFile(file) {
            // Validate file type
            if (!file.name.toLowerCase().match(/\.(html|htm)$/)) {
                showError('Please select a valid HTML file (.html or .htm)');
                return;
            }

            hideError();
            showLoading();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentFileContent = e.target.result;
                currentFileName = file.name;
                
                hideLoading();
                showPreview();
                addToRecentFiles(file.name);
            };
            
            reader.onerror = function() {
                hideLoading();
                showError('Error reading file. Please try again.');
            };
            
            reader.readAsText(file);
        }

        function showPreview() {
            homePage.classList.add('hidden');
            previewPage.classList.remove('hidden');
            fileName.textContent = currentFileName;
            
            // Create blob URL for the HTML content
            const blob = new Blob([currentFileContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            previewFrame.src = url;
            
            // Update browser history
            history.pushState({ page: 'preview' }, '', window.location.pathname + '#preview');
        }

        function showHomePage() {
            previewPage.classList.add('hidden');
            homePage.classList.remove('hidden');
            
            // Clean up blob URL
            if (previewFrame.src.startsWith('blob:')) {
                URL.revokeObjectURL(previewFrame.src);
            }
            previewFrame.src = '';
        }

        function goHome() {
            showHomePage();
            history.pushState({ page: 'home' }, '', window.location.pathname);
        }

        function refreshPreview() {
            if (currentFileContent) {
                const blob = new Blob([currentFileContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                previewFrame.src = url;
            }
        }

        function showError(message) {
            errorMessage.querySelector('p').textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        function showLoading() {
            loadingState.classList.remove('hidden');
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
        }

        function addToRecentFiles(filename) {
            // Add to beginning of array, remove duplicates, limit to 5
            recentFileNames = [filename, ...recentFileNames.filter(name => name !== filename)].slice(0, 5);
            updateRecentFilesDisplay();
        }

        function loadRecentFiles() {
            // In a real app, you'd load this from localStorage or a server
            recentFileNames = [];
            updateRecentFilesDisplay();
        }

        function updateRecentFilesDisplay() {
            if (recentFileNames.length > 0) {
                recentFiles.classList.remove('hidden');
                recentFilesList.innerHTML = recentFileNames.map(name => 
                    `<div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                        <span class="text-sm text-gray-700 dark:text-gray-300">${name}</span>
                    </div>`
                ).join('');
            } else {
                recentFiles.classList.add('hidden');
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
